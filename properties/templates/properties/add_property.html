{% extends 'core/base.html' %}
{% load crispy_forms_tags %}

{% block title %} Add Property {% endblock %}

{% block content %}
<div class="container">
  <div class="row col-md-8 offset-md-2">
    <h1 class="text-center mt-5">Add Property</h1>

    <form method="POST" class="mt-5" enctype="multipart/form-data">
      {% csrf_token %}
      
      <div class="mb-3">
        {{ form.title|as_crispy_field }}
      </div>

      <div class="mb-3">
        {{ form.city|as_crispy_field }}
      </div>

      <div class="mb-3">
        {{ form.state|as_crispy_field }}
      </div>

      <div class="mb-3">
        {{ form.zip_code|as_crispy_field }}
      </div>

      <div class="mb-3">
        {{ form.rooms|as_crispy_field }}
      </div>

      <div class="mb-3">
        {{ form.bathrooms|as_crispy_field }}
      </div>

      <div class="mb-3">
        {{ form.max_guests|as_crispy_field }}
      </div>

      <div class="mb-3">
        {{ form.price_per_night|as_crispy_field }}
      </div>

      <div class="mb-3">
        {{ form.is_available|as_crispy_field }}
      </div>

      <h4 class="mt-4">Select Amenities</h4>
      <div class="row">
        {{ form.amenities|as_crispy_field }}
      </div>

      <h4 class="mt-3">Upload Primary Image</h4>
      <div class="col-md-6 mb-3">
        <div class="primary-image-uploader">
          <label for="id_primary_image" class="image-label">
            <div class="upload-placeholder" id="primary-image-preview">
              <i class="bi bi-upload" style="font-size: 2rem;"></i>
              <p>Click or drag to upload primary image</p>
            </div>
          </label>
          <input type="file" name="primary_image" accept="image/*" style="display: none;" id="id_primary_image" required>
          <button type="button" class="close-button" id="close-primary-image" style="display:none;">&times;</button>
        </div>
      </div>

      <div class="d-flex justify-content-center mt-3">
        <button type="submit" class="btn btn-success p-2 w-25">
          Submit
        </button>
      </div>

    </form>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    const primaryImageInput = document.getElementById('id_primary_image');
    const primaryImagePreview = document.getElementById('primary-image-preview');
    const primaryImageCloseButton = document.getElementById('close-primary-image');

    primaryImageInput.addEventListener('change', function (event) {
      const file = event.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = function (e) {
          primaryImagePreview.innerHTML = `<img src="${e.target.result}" alt="Primary Image preview" style="width: 100%; height: 100%;" />`;
          primaryImageCloseButton.style.display = 'block';
        };
        reader.readAsDataURL(file);
      } else {
        primaryImagePreview.innerHTML = '<i class="bi bi-upload" style="font-size: 2rem;"></i>';
        primaryImageCloseButton.style.display = 'none';
      }
    });

    primaryImageCloseButton.addEventListener('click', function () {
      primaryImageInput.value = '';
      primaryImagePreview.innerHTML = '<i class="bi bi-upload" style="font-size: 2rem;"></i>';
      primaryImageCloseButton.style.display = 'none';
    });
  });
</script>

{% endblock %}

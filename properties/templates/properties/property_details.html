{% extends 'core/base.html' %}

{% block title %} Property Details {% endblock %}

{% block content %}
<div class="container">
  <h1>{{ property.title }}</h1>
  <div class="main-image">
    <img src="{{ property.primary_image.url }}" alt="{{ property.title }} Primary Image" class="img-fluid" />
  </div>
  <h4>Additional Images</h4>
  <div class="additional-images">
    {% if property.images.all %}
    <div class="row">
      {% for image in property.images.all %}
      <div class="col-md-4 mb-3">
        <img src="{{ image.image.url }}" alt="Additional Image" class="img-fluid" />
      </div>
      {% endfor %}
    </div>
    {% else %}
    <p>No additional images present</p>
    {% endif %}
  </div>

  <h4>Reviews</h4>
  {% if property.reviews.exists %}
  <div id="reviews-carousel" class="carousel slide" data-ride="carousel">
    <div class="carousel-inner">
      {% for review in property.reviews.all %}
      <div class="carousel-item {% if forloop.first %}active{% endif %}">
        <div class="review-content">
          <h5>{{ review.user.username }}</h5>
          <p>{{ review.content }}</p>
          <small>Rating: {{ review.rating }}</small>
        </div>
      </div>
      {% endfor %}
    </div>
    <a class="carousel-control-prev" href="#reviews-carousel" role="button" data-slide="prev">
      <span class="carousel-control-prev-icon" aria-hidden="true"></span>
      <span class="sr-only">Previous</span>
    </a>
    <a class="carousel-control-next" href="#reviews-carousel" role="button" data-slide="next">
      <span class="carousel-control-next-icon" aria-hidden="true"></span>
      <span class="sr-only">Next</span>
    </a>
  </div>
  {% else %}
  <p>No reviews yet</p>
  {% endif %}

  <div class="actions mt-4">
    {% if user.is_authenticated %}
    {% if user == property.owner %}
    <a href="{% url 'edit_property' property.id %}" class="btn btn-warning">Edit Property</a>
    <a href="{% url 'edit_images' property.id %}" class="btn btn-info">Edit Images</a>
    {% else %}
    <a href="{% url 'booking:book_property' property.id %}" class="btn btn-success">Book Now</a>
    {% if has_booked %}
    <a href="{% url 'write_review' property.id %}" class="btn btn-primary">Write Review</a>
    {% endif %}
    {% endif %}
    {% else %}
    <a href="{% url 'login' %}" class="btn btn-primary">Login to Book</a>
    {% endif %}
  </div>
</div>
{% endblock %}